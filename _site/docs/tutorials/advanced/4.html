<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  
    <title>FlashAirを使ったセンサーデータの無線モニタリング - website</title>

    
  

  <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" type="image/x-icon">

  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="http://localhost:4000/assets/css/just-the-docs.css">
  <link rel="stylesheet" href="http://localhost:4000/assets/css/customstyles.css">
  

  
    <script type="text/javascript" src="http://localhost:4000/assets/js/vendor/lunr.min.js"></script>
  
  <script type="text/javascript" src="http://localhost:4000/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>FlashAirを使ったセンサーデータの無線モニタリング | website</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="FlashAirを使ったセンサーデータの無線モニタリング" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/docs/tutorials/advanced/4.html" />
<meta property="og:url" content="http://localhost:4000/docs/tutorials/advanced/4.html" />
<meta property="og:site_name" content="website" />
<script type="application/ld+json">
{"@type":"WebPage","url":"http://localhost:4000/docs/tutorials/advanced/4.html","headline":"FlashAirを使ったセンサーデータの無線モニタリング","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>

  <div class="page-wrap">
    <div class="side-bar">
      <a href="http://localhost:4000" class="site-title lh-tight">FlashAir Developers</a>
      <span class="fs-3"><button class="js-main-nav-trigger navigation-list-toggle btn btn-outline" type="button" data-text-toggle="Hide">Menu</button></span>
      <div class="navigation main-nav js-main-nav">
        <nav role="navigation" aria-label="Main navigation">
    <ul class="navigation-list">
      
      
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <li class="navigation-list-item">
              
              <a href="http://localhost:4000/docs/tutorials/advanced/1.html" class="navigation-list-link">ステーションモードの利用</a>
            </li>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <li class="navigation-list-item">
              
              <a href="http://localhost:4000/docs/tutorials/advanced/2.html" class="navigation-list-link">FlashAirへのアップロード</a>
            </li>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <li class="navigation-list-item">
              
              <a href="http://localhost:4000/docs/tutorials/advanced/3.html" class="navigation-list-link">インターネット同時接続モードの利用</a>
            </li>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <li class="navigation-list-item active">
              
              <a href="http://localhost:4000/docs/tutorials/advanced/4.html" class="navigation-list-link active">FlashAirを使ったセンサーデータの無線モニタリング</a>
            </li>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <li class="navigation-list-item">
              
              <a href="http://localhost:4000/docs/tutorials/advanced/5.html" class="navigation-list-link">複数のFlashAirを同じ無線LANへ接続して利用する</a>
            </li>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <li class="navigation-list-item">
              
              <a href="http://localhost:4000/docs/tutorials/advanced/6.html" class="navigation-list-link">FlashAirを再読み込みする</a>
            </li>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <li class="navigation-list-item">
              
              <a href="http://localhost:4000/docs/tutorials/advanced/7.html" class="navigation-list-link">FlashAirからAmazon AWSに接続する1（準備編）</a>
            </li>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <li class="navigation-list-item">
              
              <a href="http://localhost:4000/docs/tutorials/advanced/8.html" class="navigation-list-link">FlashAirからAmazon AWSに接続する2（実行編）</a>
            </li>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <li class="navigation-list-item">
              
              <a href="http://localhost:4000/docs/tutorials/advanced/9.html" class="navigation-list-link">秘匿領域について</a>
            </li>
          
        
      
        
          
        
      
      <li class="navigation-list-item">
        <a href="https://qiita.com/kyoso_bizdev/private/da5d386a01d56511cd73" class="navigation-list-link" target="_blank">FlashAirに書き込まれたcsvファイルをAmazon S3に転送し、さらにデータをDynamoDBに書き込む</a>
      </li>
      <li>
        <br>
        <a href="./">目次に戻る</a>
      </li>
    </ul>
  </nav>
      </div>
      <footer role="contentinfo" class="site-footer">
        <p class="text-small text-grey-dk-000 mb-0">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</p>
      </footer>
    </div>
    <div class="main-content-wrap js-main-content" tabindex="0">
      <div class="page-header">
        <div class="main-content">
          
          <div class="search js-search">
            <div class="search-input-wrap">
              <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search website" aria-label="Search website" autocomplete="off">
              <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg>
            </div>
            <div class="js-search-results search-results-wrap"></div>
          </div>
          
          
        </div>
      </div>
      <div class="main-content">
        
          
            <nav class="breadcrumb-nav">
              <ol class="breadcrumb-nav-list">
                
                  <li class="breadcrumb-nav-list-item"><span>チュートリアル</span></li>
                  <li class="breadcrumb-nav-list-item"><span>上級者向けチュートリアル</span></li>
                
                <li class="breadcrumb-nav-list-item"><span>FlashAirを使ったセンサーデータの無線モニタリング</span></li>
              </ol>
            </nav>
          
        
        <div id="main-content" class="page-content" role="main">
          <h1 id="flashairを使ったセンサーデータの無線モニタリング">FlashAirを使ったセンサーデータの無線モニタリング</h1>

<p>本チュートリアルでは、FlashAirを、センサ機器の簡便な無線化オプションとして利用する方法を解説します。</p>

<hr />
<h2 id="システム概要">システム概要</h2>

<p><img src="/assets/images/arduino-sensor.jpg" alt="arduino-sensor" class="d-block" /></p>

<h3 id="機器構成">機器構成</h3>
<ul>
  <li>FlashAir</li>
  <li>Arduino</li>
  <li>SDメモリカードシールド</li>
  <li>センサー</li>
  <li>電源</li>
  <li>外箱</li>
</ul>

<h3 id="機器例">機器例</h3>
<p>写真の例では、下記の機材を使用しています。</p>
<ul>
  <li>FlashAir W-02 (容量は何でもよい)</li>
  <li>Arduino Uno R3</li>
  <li>Seeed Studio SD Shield v4.0</li>
  <li>Seeed Studio Groveシステム 押しボタン</li>
  <li>電池ボックス (本来は7V以上が推奨されています)</li>
  <li>外箱 (アクリルボックスを丁番でつなげています)</li>
</ul>

<hr />
<h2 id="動作の説明">動作の説明</h2>

<p><img src="/assets/images/tutorials/advanced_tutorial_04_2.png" alt="動作の説明" class="d-block" /></p>

<ol>
  <li>ブラウザで http://flashair/ を開く
    <ul>
      <li>HTMLテンプレート (ブラウザユーティリティとも言います) は事前に作っておく必要があります。</li>
    </ul>
  </li>
  <li>JavaScriptで約1秒ごとにファイルを読み取り、グラフを表示</li>
  <li>SD.hを使ってセンサーデータをファイルに追記</li>
</ol>

<hr />
<h2 id="ソースコード">ソースコード</h2>

<h3 id="arduino側">Arduino側</h3>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="cp">#include &lt;SD.h&gt;
</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">SOUND_SENSOR</span> <span class="o">=</span> <span class="n">A5</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">LED</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">const</span> <span class="kt">int</span> <span class="n">TIMER_COUNTER</span> <span class="o">=</span> <span class="mi">34286</span><span class="p">;</span> <span class="c1">// 2Hz. (65536 - 16MHz/256scale/2Hz)
</span>
    <span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">SLOT_SIZE</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="n">File</span> <span class="n">myFile</span><span class="p">;</span>

    <span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
    <span class="p">{</span>
     <span class="c1">// Open serial communications and wait for port to open:
</span>      <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
       <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">Serial</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">;</span> <span class="c1">// wait for serial port to connect. Needed for Leonardo only
</span>      <span class="p">}</span>

      <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Initializing SD card..."</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">SD</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"initialization failed!"</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"initialization done."</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">SD</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="s">"TEST.TXT"</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"TEST.TXT exists."</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Removing TEST.TXT..."</span><span class="p">);</span>
        <span class="n">SD</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">"TEST.TXT"</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"TEST.TXT doesn't exist."</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="n">pinMode</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
      <span class="n">pinMode</span><span class="p">(</span><span class="n">SOUND_SENSOR</span><span class="p">,</span> <span class="n">INPUT</span><span class="p">);</span>

      <span class="c1">// initialize Timer1
</span>      <span class="n">noInterrupts</span><span class="p">();</span> <span class="c1">// disable all interrupts
</span>      <span class="n">TCCR1A</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">TCCR1B</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">TCNT1</span>   <span class="o">=</span> <span class="n">TIMER_COUNTER</span><span class="p">;</span>
      <span class="n">TCCR1B</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">CS12</span><span class="p">);</span>
      <span class="n">TIMSK1</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">TOIE1</span><span class="p">);</span> <span class="c1">// enable timer overflow interrupt
</span>      <span class="n">interrupts</span><span class="p">();</span> <span class="c1">// enable all interrupts
</span>    <span class="p">}</span>
    <span class="kt">uint16_t</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">uint8_t</span>  <span class="n">slot</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">bool</span>     <span class="n">readyToSave</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="kt">uint16_t</span> <span class="n">value</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">SLOT_SIZE</span><span class="p">];</span>

    <span class="n">ISR</span><span class="p">(</span><span class="n">TIMER1_OVF_vect</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">value</span><span class="p">[</span><span class="n">slot</span><span class="p">][</span><span class="n">counter</span><span class="p">]</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">SOUND_SENSOR</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">counter</span> <span class="o">==</span> <span class="n">SLOT_SIZE</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">readyToSave</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">slot</span> <span class="o">^=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">TCNT1</span> <span class="o">=</span> <span class="n">TIMER_COUNTER</span><span class="p">;</span> <span class="c1">// preload timer
</span>    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">save</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">slotToSave</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">myFile</span> <span class="o">=</span> <span class="n">SD</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="s">"TEST.TXT"</span><span class="p">,</span> <span class="n">FILE_WRITE</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">myFile</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">SLOT_SIZE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">myFile</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="n">slotToSave</span><span class="p">][</span><span class="n">i</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="n">myFile</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="n">slotToSave</span><span class="p">][</span><span class="n">SLOT_SIZE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]);</span>
        <span class="n">myFile</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"."</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// if the file didn't open, print an error:
</span>        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"error opening TEST.TXT"</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">loop</span><span class="p">()</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">readyToSave</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">save</span><span class="p">(</span><span class="n">slot</span> <span class="o">^</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">readyToSave</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>
<p>割り込みの使用は、押しボタン程度ならば不要ですが、、変化の速いセンサーを考えて割り込みを使っています。</p>

<h3 id="htmlテンプレート側">HTMLテンプレート側</h3>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="cp">&lt;!DOCTYPE html&gt;</span>
    <span class="nt">&lt;html&gt;</span>
      <span class="nt">&lt;head&gt;</span>
      <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"/SD_WLAN/jquery-2.1.0.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>      
      <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"/SD_WLAN/ccchart-min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>      
      <span class="nt">&lt;/head&gt;</span>
      <span class="nt">&lt;body</span> <span class="na">style=</span><span class="s">"width: 99%; height: 99%; margin: 0 auto; background-color:#FFA;"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"drawing"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;canvas</span> <span class="na">id=</span><span class="s">"graph"</span> <span class="na">width=</span><span class="s">"240"</span> <span class="na">height=</span><span class="s">"360"</span> <span class="na">style=</span><span class="s">"width:99%; max-width: 400px; height:99%; max-height: 600px;"</span><span class="nt">&gt;&lt;/canvas&gt;</span>
      <span class="nt">&lt;/div&gt;</span>

      <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
    <span class="kd">function</span> <span class="nx">drawBars</span><span class="p">(</span><span class="nx">testData</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#graph'</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">chartdata</span> <span class="o">=</span> <span class="p">{</span>

        <span class="s1">'config'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'title'</span><span class="p">:</span> <span class="s1">'FlashAir x Sensor'</span><span class="p">,</span>
        <span class="s1">'titleFont'</span><span class="p">:</span> <span class="s1">'100 16px "Arial"'</span><span class="p">,</span>
        <span class="s1">'type'</span><span class="p">:</span> <span class="s1">'line'</span><span class="p">,</span>
        <span class="s1">'lineWidth'</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s1">'minY'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">'maxY'</span><span class="p">:</span> <span class="mi">1100</span><span class="p">,</span>
        <span class="s1">'useVal'</span><span class="p">:</span> <span class="s1">'yes'</span><span class="p">,</span>
        <span class="s1">'onlyChartWidthTitle'</span><span class="p">:</span> <span class="s1">'yes'</span><span class="p">,</span>
        <span class="s1">'colorSet'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'yellow'</span><span class="p">],</span>
        <span class="s1">'bgGradient'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'direction'</span><span class="p">:</span><span class="s1">'vertical'</span><span class="p">,</span>
            <span class="s1">'from'</span><span class="p">:</span><span class="s1">'#333'</span><span class="p">,</span>
            <span class="s1">'to'</span><span class="p">:</span><span class="s1">'#000'</span>
          <span class="p">},</span>
        <span class="s1">'width'</span><span class="p">:</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">(),</span>
        <span class="s1">'height'</span><span class="p">:</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span>
        <span class="p">},</span>

        <span class="s1">'data'</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">[</span><span class="s1">'time'</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">20</span><span class="p">],</span>
          <span class="p">[</span><span class="s1">'brightness'</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
        <span class="p">]</span>
      <span class="p">};</span>
     <span class="kd">var</span> <span class="nx">values</span> <span class="o">=</span> <span class="nx">testData</span><span class="p">.</span><span class="nx">trim</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s1">'</span><span class="err">\</span><span class="s1">n'</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">MAX_BARS</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">first</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">values</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="nx">MAX_BARS</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">last</span>  <span class="o">=</span> <span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">first</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">last</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">-</span> <span class="nx">first</span><span class="p">;</span>
        <span class="nx">chartdata</span><span class="p">[</span><span class="s1">'data'</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span> <span class="o">+</span> <span class="nx">n</span><span class="p">]</span> <span class="o">=</span> <span class="nx">values</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>

      <span class="nx">ccchart</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="s1">'graph'</span><span class="p">,</span> <span class="nx">chartdata</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">repeater</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
        <span class="na">url</span><span class="p">:</span> <span class="s1">'/TEST.TXT?TIME='</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">),</span>
        <span class="na">datatype</span><span class="p">:</span> <span class="s1">'text'</span><span class="p">,</span>
        <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">dataType</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">drawBars</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
          <span class="nx">setTimeout</span><span class="p">(</span><span class="s1">'repeater()'</span><span class="p">,</span> <span class="mi">800</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="na">error</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">setTimeout</span><span class="p">(</span><span class="s1">'repeater()'</span><span class="p">,</span> <span class="mi">800</span><span class="p">);</span>
        <span class="p">},</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="s2">"100</span><span class="err">\</span><span class="s2">n200</span><span class="err">\</span><span class="s2">n300</span><span class="err">\</span><span class="s2">n400</span><span class="err">\</span><span class="s2">n500</span><span class="err">\</span><span class="s2">n600</span><span class="err">\</span><span class="s2">n700</span><span class="err">\</span><span class="s2">n800</span><span class="err">\</span><span class="s2">n900</span><span class="err">\</span><span class="s2">n1000</span><span class="err">\</span><span class="s2">n100</span><span class="err">\</span><span class="s2">n200</span><span class="err">\</span><span class="s2">n300</span><span class="err">\</span><span class="s2">n400</span><span class="err">\</span><span class="s2">n500</span><span class="err">\</span><span class="s2">n600</span><span class="err">\</span><span class="s2">n700</span><span class="err">\</span><span class="s2">n800</span><span class="err">\</span><span class="s2">n900</span><span class="err">\</span><span class="s2">n1000</span><span class="err">\</span><span class="s2">n"</span><span class="p">;</span>
      <span class="nx">drawBars</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>

      <span class="nx">repeater</span><span class="p">();</span>
    <span class="p">}</span>
      <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
    <span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>
<p>以下のライブラリを使用しています。</p>

<ul>
  <li>jquery 2.1 <a href="http://jquery.com/" target="_blank">http://jquery.com/</a></li>
  <li>ccchart <a href="https://ccchart.com/" target="_blank">https://ccchart.com/</a></li>
</ul>

<h3 id="センサーデータファイル-texttxt">センサーデータファイル (TEXT.TXT)</h3>

<p>1行に1個の数値が並んでいるのみ
<img src="/assets/images/tutorials/advanced_tutorial_04_3.png" alt="センサーデータファイル" class="d-block" /></p>

<p>Arduino起動時にクリア (ファイル削除)</p>

<ul>
  <li>容量が増えるとダウンロードが遅くなるため、データ量が多い・全部保存したい、などの場合はリングバッファ方式の導入など検討したほうがよいでしょう。</li>
</ul>


          
        </div>
      </div>
    </div>
  </div>

</body>
</html>
