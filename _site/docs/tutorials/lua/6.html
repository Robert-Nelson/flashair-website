<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  
    <title>OAUTH2を使ったDropboxへのアップロード - website</title>

    
  

  <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" type="image/x-icon">

  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="http://localhost:4000/assets/css/just-the-docs.css">
  <link rel="stylesheet" href="http://localhost:4000/assets/css/customstyles.css">
  

  
    <script type="text/javascript" src="http://localhost:4000/assets/js/vendor/lunr.min.js"></script>
  
  <script type="text/javascript" src="http://localhost:4000/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>OAUTH2を使ったDropboxへのアップロード | website</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="OAUTH2を使ったDropboxへのアップロード" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/docs/tutorials/lua/6.html" />
<meta property="og:url" content="http://localhost:4000/docs/tutorials/lua/6.html" />
<meta property="og:site_name" content="website" />
<script type="application/ld+json">
{"@type":"WebPage","url":"http://localhost:4000/docs/tutorials/lua/6.html","headline":"OAUTH2を使ったDropboxへのアップロード","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>

  <div class="page-wrap">
    <div class="side-bar">
      <a href="http://localhost:4000" class="site-title lh-tight">FlashAir Developers</a>
      <span class="fs-3"><button class="js-main-nav-trigger navigation-list-toggle btn btn-outline" type="button" data-text-toggle="Hide">Menu</button></span>
      <div class="navigation main-nav js-main-nav">
        <nav role="navigation" aria-label="Main navigation">
    <ul class="navigation-list">
      
      
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <li class="navigation-list-item">
              
              <a href="http://localhost:4000/docs/tutorials/lua/1.html" class="navigation-list-link">FlashAir Lua機能の概要</a>
            </li>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <li class="navigation-list-item">
              
              <a href="http://localhost:4000/docs/tutorials/lua/2.html" class="navigation-list-link">FlashAirでLuaを実行する</a>
            </li>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <li class="navigation-list-item">
              
              <a href="http://localhost:4000/docs/tutorials/lua/3.html" class="navigation-list-link">HTTPを利用したファイルのダウンロード</a>
            </li>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <li class="navigation-list-item">
              
              <a href="http://localhost:4000/docs/tutorials/lua/4.html" class="navigation-list-link">FTPを使ったファイルのアップロード</a>
            </li>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <li class="navigation-list-item">
              
              <a href="http://localhost:4000/docs/tutorials/lua/5.html" class="navigation-list-link">Facebookへのアップロード</a>
            </li>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <li class="navigation-list-item active">
              
              <a href="http://localhost:4000/docs/tutorials/lua/6.html" class="navigation-list-link active">OAUTH2を使ったDropboxへのアップロード</a>
            </li>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <li class="navigation-list-item">
              
              <a href="http://localhost:4000/docs/tutorials/lua/7.html" class="navigation-list-link">無線LAN設定</a>
            </li>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <li class="navigation-list-item">
              
              <a href="http://localhost:4000/docs/tutorials/lua/8.html" class="navigation-list-link">Webインターフェースの作成</a>
            </li>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <li class="navigation-list-item">
              
              <a href="http://localhost:4000/docs/tutorials/lua/9.html" class="navigation-list-link">Googleドライブへのアップロード</a>
            </li>
          
        
      
        
          
        
      
        
          
            <li class="navigation-list-item">
              
              <a href="http://localhost:4000/docs/tutorials/lua/10.html" class="navigation-list-link">Luaスクリプトをバイトコードにコンパイル</a>
            </li>
          
        
      

      <li>
        <br>
        <a href="./">目次に戻る</a>
      </li>
    </ul>
  </nav>
      </div>
      <footer role="contentinfo" class="site-footer">
        <p class="text-small text-grey-dk-000 mb-0">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</p>
      </footer>
    </div>
    <div class="main-content-wrap js-main-content" tabindex="0">
      <div class="page-header">
        <div class="main-content">
          
          <div class="search js-search">
            <div class="search-input-wrap">
              <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search website" aria-label="Search website" autocomplete="off">
              <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg>
            </div>
            <div class="js-search-results search-results-wrap"></div>
          </div>
          
          
        </div>
      </div>
      <div class="main-content">
        
          
            <nav class="breadcrumb-nav">
              <ol class="breadcrumb-nav-list">
                
                  <li class="breadcrumb-nav-list-item"><span>チュートリアル</span></li>
                  <li class="breadcrumb-nav-list-item"><span>Lua機能チュートリアル</span></li>
                
                <li class="breadcrumb-nav-list-item"><span>OAUTH2を使ったDropboxへのアップロード</span></li>
              </ol>
            </nav>
          
        
        <div id="main-content" class="page-content" role="main">
          <h1 id="oauth2を使ったdropboxへのアップロード">OAUTH2を使ったDropboxへのアップロード</h1>

<p>このチュートリアルでは、Dropboxへファイルをアップロードする方法をみていきます。このスクリプトは、アップロードとアクセストークンの保存を行います。</p>

<hr />
<h2 id="はじめに">はじめに</h2>

<ol>
  <li>FlashAirにUploadフォルダを作成し、アップロードするファイルを設置します。</li>
  <li><a href="../../api/config/#upload">アップロード機能を有効</a>にするために、CONFIGファイルに<code class="highlighter-rouge">UPLOAD=1</code>を追加します。</li>
  <li><a href="2">FlashAirでLuaを実行する</a>を参考に、Luaスクリプト実行方法をCONFIGファイルに指定します。</li>
</ol>

<hr />
<h2 id="アプリの登録">アプリの登録</h2>

<p>この作業は、インターネットに接続されたPC上で行います。</p>

<ol>
  <li><a href="https://www.dropbox.com/developers/" target="_blank">Dropbox Developers</a>を開きます。</li>
  <li>画面右上の”Sign in”をクリックし、Dropboxアカウントにログインします。</li>
  <li>ログイン後、左ナビゲーションの”My apps”をクリックし、”Create apps”をクリックします。
  <img src="/assets/images/tutorials/lua_tutorial_06_01.png" alt="アプリの登録" class="d-block img-thumbnail" /></li>
  <li>APIの設定をすべて入力し、”Create app”をクリックしてください。
  <img src="/assets/images/tutorials/lua_tutorial_06_02.png" alt="アプリの登録" class="d-block img-thumbnail" />
    <ul>
      <li>例: “Dropbox API”,”App folder”,”Lua Upload”</li>
    </ul>
  </li>
  <li>appが作成できると、App keyとApp secretが取得できます。App secretは”Show”をクリックすると表示されます。これらの情報は取扱に注意し、他人と共有しないようにしてください。
  <img src="/assets/images/tutorials/lua_tutorial_06_03.png" alt="アプリの登録" class="d-block img-thumbnail" /></li>
  <li>以下のリンクより”authorization code”を取得します。ウェブブラウザから以下のURLにアクセスします。client_idには取得したApp keyを入力してください。
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  https://www.dropbox.com/oauth2/authorize?client_id=btbjfXxXxXxXxXx&amp;response_type=code
</code></pre></div>    </div>
  </li>
  <li>APIリクエストの承認画面が出るので、”許可”をクリックします。
  <img src="/assets/images/tutorials/lua_tutorial_06_04.png" alt="アプリの登録" class="d-block img-thumbnail" /></li>
  <li>APIリクエストが承認されました。取得した”authorization code”を控えておきます。
  <img src="/assets/images/tutorials/lua_tutorial_06_05.png" alt="アプリの登録" class="d-block img-thumbnail" /></li>
</ol>

<hr />
<h2 id="さあはじめましょう">さあはじめましょう</h2>

<p>これで準備ができました。もし最後に実行するスクリプトで、再認証が求められたら、取得したコードの期限が切れている可能性がありますので、再度”authorization code”を取得します。</p>

<h5 id="dropboxuploadlua"><em>/DropboxUpload.lua</em></h5>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="cm">--[[
    FlashAir Lua Dropbox example.

    This script uploads and files in a directory to dropbox, using oauth2.
    It will store the access token in dropbox_token.txt
    --]]</span>
    <span class="kd">local</span> <span class="n">tokenfile</span>		<span class="o">=</span> <span class="s2">"/dropbox_token.txt"</span> 	<span class="c1">-- Where to log output on the FA</span>
    <span class="kd">local</span> <span class="n">folder</span> 		<span class="o">=</span> <span class="s2">"/Upload"</span> 		<span class="c1">-- What folder to upload files from</span>
    <span class="kd">local</span> <span class="n">app_key</span>		<span class="o">=</span> <span class="s2">"btbjfXxXxXxXxXx"</span>	<span class="c1">-- Your Dropbox app's key</span>
    <span class="kd">local</span> <span class="n">app_secret</span>	<span class="o">=</span> <span class="s2">"4k79gXxXxXxXxXx"</span>	<span class="c1">-- Your Dropbox app's secret</span>

    <span class="c1">--NOTE: Remember to authorize your app!</span>
    <span class="kd">local</span> <span class="n">auth_code</span> 	<span class="o">=</span> <span class="s2">"XrfRXkfTNcXxXxXxXxXxXxXxXxXxXxXxXxXxXxXxXxX"</span> <span class="c1">-- authorization code</span>
</code></pre></div></div>
<p>次に、
<a href="../../api/lua/#request">fa.request</a>を使用して、アクセストークンを取得しましょう。</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="cm">--[[
    requestToken(app key, app secret, authorization code)
    requests the oath2 token, using fa.request().
    returns the token, or nil on a failure.
    --]]</span>
    <span class="kd">local</span> <span class="k">function</span> <span class="nf">requestToken</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">secret</span><span class="p">,</span> <span class="n">auth_code</span><span class="p">)</span>
    	<span class="c1">--Request a token</span>
    	<span class="n">message</span> <span class="o">=</span> <span class="s2">"grant_type=authorization_code&amp;code="</span><span class="o">..</span><span class="n">auth_code</span><span class="o">..</span><span class="s2">"&amp;client_id="</span><span class="o">..</span><span class="n">key</span><span class="o">..</span><span class="s2">"&amp;client_secret="</span><span class="o">..</span><span class="n">secret</span>
    	<span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">fa</span><span class="p">.</span><span class="n">request</span><span class="p">{</span>
    		<span class="n">url</span> <span class="o">=</span> <span class="s2">"https://api.dropboxapi.com/oauth2/token"</span><span class="p">,</span>
    		<span class="n">method</span> <span class="o">=</span> <span class="s2">"POST"</span><span class="p">,</span>
    		<span class="n">headers</span> <span class="o">=</span> <span class="p">{[</span><span class="s2">"Content-Length"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">string.len</span><span class="p">(</span><span class="n">message</span><span class="p">),</span>
    		<span class="p">[</span><span class="s2">"Content-Type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"application/x-www-form-urlencoded"</span><span class="p">},</span>
    		<span class="n">body</span> <span class="o">=</span> <span class="n">message</span>
    	<span class="p">}</span>

    	<span class="c1">--Decode the response body (json format)</span>
    	<span class="n">response</span> <span class="o">=</span> <span class="n">cjson</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    	<span class="n">access_token</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">"access_token"</span><span class="p">]</span>
    	<span class="k">if</span> <span class="n">access_token</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="k">then</span>
    		<span class="k">return</span> <span class="n">access_token</span>
    	<span class="k">else</span>
    		<span class="nb">error</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">"error_description"</span><span class="p">]</span>
    		<span class="nb">print</span><span class="p">(</span><span class="s2">"Failed to get access token. Error: "</span><span class="o">..</span><span class="n">c</span><span class="o">..</span><span class="s2">": "</span><span class="o">..</span><span class="nb">error</span><span class="p">)</span>
    		<span class="k">return</span> <span class="kc">nil</span>
    	<span class="k">end</span>
    <span class="k">end</span>
</code></pre></div></div>
<p>取得したトークンを保存するために、2つの関数を用意ましょう。</p>

<p><span class="badge label-blue">Note:</span> FlashAirをPCにマウントしてスクリプトを実行している場合、アクセストークンファイルを書き込めないことがあります。その場合は、一度FlashAir取り出して、もう一度実行してみてください。</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="cm">--[[
    These functions simply load or save the access token to/from a file (tokenfile).
    --]]</span>
    <span class="kd">local</span> <span class="k">function</span> <span class="nf">saveToken</span><span class="p">(</span><span class="n">access_token</span><span class="p">)</span>
    	<span class="kd">local</span> <span class="n">file</span> <span class="o">=</span> <span class="nb">io.open</span><span class="p">(</span><span class="n">tokenfile</span><span class="p">,</span> <span class="s2">"w"</span> <span class="p">)</span>
    	<span class="n">file</span><span class="p">:</span><span class="n">write</span><span class="p">(</span><span class="n">access_token</span><span class="p">)</span>
    	<span class="nb">io.close</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="kd">local</span> <span class="k">function</span> <span class="nf">loadToken</span><span class="p">()</span>
    	<span class="kd">local</span> <span class="n">file</span> <span class="o">=</span> <span class="nb">io.open</span><span class="p">(</span><span class="n">tokenfile</span><span class="p">,</span> <span class="s2">"r"</span> <span class="p">)</span>
    	<span class="n">access_token</span> <span class="o">=</span> <span class="kc">nil</span>
    	<span class="k">if</span> <span class="n">file</span> <span class="k">then</span>
    		<span class="n">access_token</span> <span class="o">=</span> <span class="n">file</span><span class="p">:</span><span class="n">read</span><span class="p">(</span> <span class="s2">"*a"</span> <span class="p">)</span>
    	<span class="k">end</span>
    	<span class="k">return</span> <span class="n">access_token</span>
    <span class="k">end</span>
</code></pre></div></div>
<p>最後に、実際にファイルをアップロードする関数を書いてみましょう。ここでは、また
<a href="../../api/lua/#request">fa.request</a>を使用して、PUTリクエストを実行します。</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">--[[
	uploadFile(folder, file name, access token)
	Attempts to upload a file to dropbox!
--]]</span>
<span class="kd">local</span> <span class="k">function</span> <span class="nf">uploadFile</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">access_token</span><span class="p">)</span>
	<span class="n">file_path</span><span class="o">=</span><span class="n">folder</span> <span class="o">..</span> <span class="s2">"/"</span> <span class="o">..</span> <span class="n">file</span>
	<span class="c1">--get the size of the file</span>
	<span class="kd">local</span> <span class="n">filesize</span> <span class="o">=</span> <span class="n">lfs</span><span class="p">.</span><span class="n">attributes</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="s2">"size"</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">filesize</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="k">then</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">"Uploading "</span><span class="o">..</span><span class="n">file_path</span><span class="o">..</span><span class="s2">" size: "</span><span class="o">..</span><span class="n">filesize</span><span class="p">)</span>
	<span class="k">else</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">"Failed to find "</span><span class="o">..</span><span class="n">file_path</span><span class="o">..</span><span class="s2">"... something wen't wrong!"</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="k">end</span>

	<span class="c1">--Upload!</span>
	<span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">fa</span><span class="p">.</span><span class="n">request</span><span class="p">{</span>
		<span class="n">url</span> <span class="o">=</span> <span class="s2">"https://content.dropboxapi.com/2/files/upload"</span><span class="p">,</span>
		<span class="n">method</span> <span class="o">=</span> <span class="s2">"POST"</span><span class="p">,</span>
		<span class="n">headers</span> <span class="o">=</span> <span class="p">{[</span><span class="s2">"Authorization"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Bearer "</span><span class="o">..</span><span class="n">access_token</span><span class="p">,</span>
		<span class="p">[</span><span class="s2">"Content-Length"</span><span class="p">]</span> <span class="o">=</span> <span class="n">filesize</span><span class="p">,</span>
		<span class="p">[</span><span class="s2">"Content-Type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"application/octet-stream"</span><span class="p">,</span>
		<span class="p">[</span><span class="s2">"Dropbox-API-Arg"</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'{"path":"'</span><span class="o">..</span><span class="n">file_path</span><span class="o">..</span><span class="s1">'","mode":{".tag":"overwrite"}}'</span><span class="p">},</span>
		<span class="n">body</span> <span class="o">=</span> <span class="s2">"&lt;!--WLANSDFILE--&gt;"</span><span class="p">,</span>
		<span class="n">bufsize</span> <span class="o">=</span> <span class="mi">1460</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span>
		<span class="n">file</span><span class="o">=</span><span class="n">file_path</span>
	<span class="p">}</span>

	<span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

<span class="k">end</span>
</code></pre></div></div>
<p>これで全てがそろいました。さあ実行してみましょう！保存しているトークンの読み込みを行います。読み込みが失敗した場合、トークンをリクエスト、もしくはauthorization codeの入力を要求します。
そして、LuaFileSystemを使ってディレクトリ内をスキャンし、
<a href="4">FTPチュートリアル</a>同様にアップロードします。</p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">--Script starts</span>

<span class="c1">--Attempt to load a token from the file</span>
<span class="n">token</span> <span class="o">=</span> <span class="n">loadToken</span><span class="p">()</span>

<span class="c1">--See if we loaded one, if not request one</span>
<span class="k">if</span> <span class="n">token</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">then</span>
	<span class="c1">--Request an access token</span>
	<span class="nb">print</span><span class="p">(</span><span class="s2">"No token found, attempting to request one..."</span><span class="p">)</span>
	<span class="n">token</span> <span class="o">=</span> <span class="n">requestToken</span><span class="p">(</span><span class="n">app_key</span><span class="p">,</span> <span class="n">app_secret</span><span class="p">,</span> <span class="n">auth_code</span><span class="p">)</span>

	<span class="c1">--Was it successful?</span>
	<span class="k">if</span> <span class="n">token</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">then</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">"Failed to request token, do you need to authorize?"</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">"Auth url: https://www.dropbox.com/oauth2/authorize?client_id="</span><span class="o">..</span><span class="n">app_key</span><span class="o">..</span><span class="s2">"&amp;response_type=code"</span><span class="p">)</span>
	<span class="k">else</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">"New token: "</span><span class="o">..</span><span class="n">token</span><span class="p">)</span>
		<span class="n">saveToken</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
	<span class="k">end</span>

<span class="k">end</span>

<span class="c1">--Before continuing, make sure we have an access token</span>
<span class="k">if</span> <span class="n">token</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="k">then</span>
	<span class="nb">print</span><span class="p">(</span><span class="s2">"INIT, with token: "</span><span class="o">..</span><span class="n">token</span><span class="p">)</span>
	<span class="c1">-- For each file in folder...</span>
	<span class="k">for</span> <span class="n">file</span> <span class="k">in</span> <span class="n">lfs</span><span class="p">.</span><span class="n">dir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span> <span class="k">do</span>
		<span class="c1">-- Get that file's attributes</span>
		<span class="n">attr</span> <span class="o">=</span> <span class="n">lfs</span><span class="p">.</span><span class="n">attributes</span><span class="p">(</span><span class="n">folder</span> <span class="o">..</span> <span class="s2">"/"</span> <span class="o">..</span> <span class="n">file</span><span class="p">)</span>

		<span class="c1">-- Don't worry about directories (yet)</span>
		<span class="k">if</span> <span class="n">attr</span><span class="p">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">"file"</span> <span class="k">then</span>
			<span class="c1">--Attempt to upload the file!</span>
			<span class="n">uploadFile</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span>
		<span class="k">end</span>
	<span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>
<p><a href="https://www.dropbox.com/home" target="_blank">Dropbox</a>にアクセスし、アプリフォルダをクリックします。</p>

<p><img src="/assets/images/tutorials/lua_tutorial_06_06.png" alt="アプリの登録" class="d-block img-thumbnail" /></p>

<p>作成したアプリ名をクリックします。</p>

<p><img src="/assets/images/tutorials/lua_tutorial_06_07.png" alt="アプリの登録" class="d-block img-thumbnail" /></p>

<p>アップロードしたファイルが表示されます。
<img src="/assets/images/tutorials/lua_tutorial_06_08.png" alt="アプリの登録" class="d-block img-thumbnail" /></p>

<hr />
<h2 id="サンプルコード">サンプルコード</h2>

<p><a href="https://github.com/FlashAirDevelopers/LuaTutorial/tree/master/lua_tutorial_6" target="_blank" class="btn btn-primary">リポジトリを見る（GitHub）</a></p>

<p>このサイトのサンプルコードはLGPLv2または<a href="../../license">二条項BSDライセンス</a>で提供されています。</p>



          
        </div>
      </div>
    </div>
  </div>

</body>
</html>
