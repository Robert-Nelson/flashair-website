---
layout: tutorials-api
title: command.cgi
parent: APIガイド
nav_order: 1
---

# command.cgi

command.cgiを使うと、スマートフォン、PCなどから、 無線LAN経由でFlashAirの情報を取得したり、設定を変更したりできます。

[CGI (Common Gateway Interface)](http://ja.wikipedia.org/wiki/Common_Gateway_Interface){: target="_blank" }という仕組みを利用しており、 FlashAirに接続した状態で、下記のURLにHTTP GETリクエストを発行することでコマンドを実行できます。

`http://flashair/command.cgi?<パラメータ>`

利用できるコマンドは下記のとおりです。

機能                                             | パラメータ例                            | ファームウェアバージョン
------------------------------------------------ | -------------------------------------- | ---------------
[ファイルリストの取得](#100)                       | `op=100&DIR=/DCIM`                     | 1.00.00+       
[ファイル数の取得](#101)                           | `op=101&DIR=/DCIM`                     | 1.00.00+       
[アップデート情報の取得](#102)                     | `op=102`                               | 1.00.00+       
[SSIDの取得](#104)                                | `op=104`                               | 1.00.00+       
[ネットワークパスワードの取得](#105)                | `op=105`                               | 1.00.00+       
[MACアドレスの取得](#106)                          | `op=106`                               | 1.00.00+       
[ブラウザ言語の取得](#107)                         | `op=107`                               | 1.00.00+       
[ファームウェアバージョン情報の取得](#108)          | `op=108`                               | 1.00.00+       
[制御イメージの取得](#109)                         | `op=109`                               | 2.00.00+       
[無線LANモードの取得](#110)                        | `op=110`                               | 2.00.00+       
[無線LANタイムアウト時間の取得](#111)               | `op=111`                               | 2.00.00+       
[アプリケーション独自情報の取得](#117)              | `op=117`                               | 2.00.00+       
[アップロード機能の有効状態の取得](#118)            | `op=118`                               | 2.00.02+       
[CIDの取得](#120)                                 | `op=120`                               | 1.00.03+       
[アップデート情報の取得 (タイムスタンプ形式)](#121)  | `op=121`                               | 2.00.02+       
[共有メモリからのデータの取得](#130)                | `op=130&ADDR=0&LEN=8`                  | 2.00.00+       
[共有メモリへのデータの書き込み](#131)              | `op=131&ADDR=0&LEN=8&DATA=0123ABCD`    | 2.00.00+       
[空セクター数の取得](#140)                         | `op=140`                               | 1.00.03+       
[SDインターフェース端子のI/O利用](#190)             | `op=190&CTRL=0x1f&DATA=0x1f`           | 2.00.03+       
[フォトシェアモードの有効化](#200)                 | `op=200&DIR=/DCIM/100__TSB&DATE=17153` | 2.00.00+       
[フォトシェアモードの解除](#201)                   | `op=201`                               | 2.00.00+       
[フォトシェアモードの状態の取得](#202)              | `op=202`                               | 2.00.00+       
[フォトシェアモードのSSIDの取得](#203)             | `op=203`                               | 2.00.00+       
[FlashAirドライブ(WebDAV)情報の取得](#220)        | `op=220`                               | 3.00.00+       
[タイムゾーンの取得](#221)                        | `op=221`                               | 3.00.00+       

---
<h2 id="100">ファイルリストの取得</h2>
{: .mb-0 }
(op=100)
{: .text-small }

指定したディレクトリ内のファイルリストを返します。

### リクエスト例:

  `http://flashair/command.cgi?op=100&DIR=/DCIM`

### パラメータ:

##### **DIR**
ディレクトリパス

### レスポンス例:
```
WLANSD_FILELIST
/DCIM,100__TSB,0,16,9944,129
/DCIM,0126_1.jpg,70408,32,17071,28040
```
レスポンスの各行は下記のフォーマットで返されます。
```
<directory>, <filename>, <size>, <attribute>, <date>, <time>
```
ファイル名にカンマ(`,`)を含む場合がありますので、レスポンスを解析する場合はご注意ください。<br>
DIR=/ (root)を指定した場合、ディレクトリ名は空になりますのでご注意ください。

##### **\<directory\>**
ファイルのあるディレクトリ名
##### **\<filename\>**
ファイル名
##### **\<size\>**
ファイルサイズ (数字は10進法)
##### **\<attribute\>**
ファイルの属性 (数字は10進法)
##### **\<date\>**
ファイルの日時 (数字は10進法)
##### **\<time\>**
ファイルの時間 (数字は10進法)

`Attribute` (属性)は下記のフォーマットの16ビット整数を10進数表記で指定します。

<dl class="ml-4">
  <dt>ビット 5</dt>
  <dd>アーカイブ</dd>
  <dt>ビット 4</dt>
  <dd>ディレクトリ</dd>
  <dt>ビット 3</dt>
  <dd>ボリューム</dd>
  <dt>ビット 2</dt>
  <dd>システムファイル</dd>
  <dt>ビット 1</dt>
  <dd>隠しファイル</dd>
  <dt>ビット 0</dt>
  <dd>読み取り専用</dd>
</dl>

`Date` (日付)は下記のフォーマットの16ビット整数を10進数表記で指定します。

<dl class="ml-4">
  <dt>ビット 15-9</dt>
  <dd>年。1980年を0とした値で指定します。</dd>
  <dt>ビット 8-5</dt>
  <dd>月。1～12の値を指定します。</dd>
  <dt>ビット 4-0</dt>
  <dd>日。1～31の値を指定します。</dd>
</dl>

`Time` (時刻)は下記のフォーマットの16ビット整数を10進数表記で指定します。

<dl>
  <dt>ビット 15-11</dt>
  <dd>時</dd>
  <dt>ビット 10-5</dt>
  <dd>分</dd>
  <dt>ビット 4-0</dt>
  <dd>秒/2</dd>
</dl>

この機能は、ファームウェアバージョン1.00.00以上で利用可能です。

---

<h2 id="101">ファイル数の取得</h2>
{: .mb-0 }
(op=101)
{: .text-small }

指定したディレクトリ内のファイル数を返します。

### リクエスト例:

  `http://flashair/command.cgi?op=101&DIR=/DCIM`

### レスポンス例:

`2`

この機能は、ファームウェアバージョン1.00.00以上で利用可能です。

---
<h2 id="102">アップデート情報の取得</h2>
{: .mb-0 }
(op=102)
{: .text-small}

FlashAirメモリがアップデートされているかどうかを返します。アップデートされている場合は`1` 、されていない場合は`0` を返します。一度呼ばれるとステイタスはクリアされます。

### リクエスト例:

  `http://flashair/command.cgi?op=102`

### レスポンス例:

  `1`

この機能は、ファームウェアバージョン1.00.00以上で利用可能です。

---
<h2 id="104">SSIDの取得</h2>
{: .mb-0 }
(op=104)
{: .text-small }

FlashAirのSSIDを返します。 (最大32文字)

### リクエスト例:

`http://flashair/command.cgi?op=104`

### レスポンス例:

`flashair_e8e0b756a7fb`

この機能は、ファームウェアバージョン1.00.00以上で利用可能です。

---
<h2 id="105">ネットワークパスワードの取得</h2>
{: .mb-0 }
(op=105)
{: .text-small }

FlashAirがAPモードに設定されている場合のネットワークキーを、 最大63桁の半角英数字で返します。 ただし、連携デジタルカメラなどのSDメモリカードホスト機器から設定されたネットワークキーは表示されません。

### リクエスト例:

`http://flashair/command.cgi?op=105`

### レスポンス例:

`12345678`

この機能は、ファームウェアバージョン1.00.00以上で利用可能です。

---
<h2 id="106">MACアドレスの取得</h2>
{: .mb-0}
(op=106)
{: .text-small }

リクエストを発行したクライアントのMACアドレスを返します。

### リクエスト例:

`http://flashair/command.cgi?op=106`

### レスポンス例:

`a41731f4d880`

この機能は、ファームウェアバージョン1.00.00以上で利用可能です。

---
<h2 id="107">ブラウザ言語の取得</h2>
{: .mb-0 }
(op=107)
{: .text-small }

ブラウザの言語設定で利用可能な言語(Accept-Languageパラメータ)を返します。

### リクエスト例:

`http://flashair/command.cgi?op=107`

### レスポンス例:

  `Accept-Language: ja,en-US;q=0.8,en;q=0.6`

この機能は、ファームウェアバージョン1.00.00以上で利用可能です。

---
<h2 id="108">ファームウェアバージョン情報の取得</h2>
{: .mb-0 }
(op=108)
{: .text-small }

FlashAirのファームウェアのバージョンを返します。**F24**で始まるバージョンはW-01カード用の1.00系列、**F19**で始まるバージョンはW-02カード用の2.00系列です。

### リクエスト例:

`http://flashair/command.cgi?op=108`

### レスポンス例:

`F19BAW3AW2.00.00`

この機能は、ファームウェアバージョン1.00.00以上で利用可能です。

---
<h2 id="109">制御イメージの取得</h2>
{: .mb-0 }
(op=109)
{: .text-small }

無線起動画面として使う画像ファイルのフルパス(CIPATH)を取得します。 無線起動画面とは、無線LANモードが0,2,3のいずれかである場合に、無線LAN機能のON/OFFを制御するための画像ファイルです。

CIPATHについては、CONFIGの[CIPATHに関する記述]({{ site.baseurl }}/docs/api/config#cipath)を参照してください。

### リクエスト例:

`http://flashair/command.cgi?op=109`

### レスポンス例:

`/DCIM/100__TSB/FA000001.JPG`

この機能は、ファームウェアバージョン2.00.00以上で利用可能です。

---
<h2 id="110">無線LANモードの取得</h2>
{: .mb-0 }
(op=110)
{: .text-small }

デフォルトの無線LANモード(APPMODE)を返します。APPMODEについては、CONFIGの[APPMODEに関する記述]({{ site.baseurl }}/docs/api/config#APPMODE)を参照してください。

### リクエスト例:

`http://flashair/command.cgi?op=110`

### レスポンス例:

`4`

この機能は、ファームウェアバージョン2.00.00以上で利用可能です。

---
<h2 id="111">無線LANタイムアウト時間の取得</h2>
{: .mb-0 }
(op=111)
{: .text-small }

無線LANにアクセスがない場合に自動的に電源を切るまでのタイムアウト時間(APPAUTOTIME)をミリ秒単位で返します。 無線LANモードが自動起動APモードに設定されている場合のみ有効です。APPAUTOTIMEについては、CONFIGの[APPAUTOTIMEに関する記述]({{ site.baseurl }}/docs/api/config#appautotime)を参照してください。

### リクエスト例:

`http://flashair/command.cgi?op=111`

### レスポンス例:

`300000`

この機能は、ファームウェアバージョン2.00.00以上で利用可能です。

---
<h2 id="117">アプリケーション独自情報の取得</h2>
{: .mb-0 }
(op=117)
{: .text-small }

アプリケーションが独自の目的で使用することができる16ケタの英数字(APPINFO)を取得します。APPINFOについては、CONFIGの[APPINFOに関する記述]({{ site.baseurl }}/docs/api/config#appinfo)を参照してください。

### リクエスト例:

`http://flashair/command.cgi?op=117`

### レスポンス例:

`0123ABCD4567EFGH`

この機能は、ファームウェアバージョン2.00.00以上で利用可能です。

---
<h2 id="118">アップロード機能の有効状態の取得</h2>
{: .mb-0 }
(op=118)
{: .text-small }

CONFIGファイルの`UPLOAD`の値を返します。

1    |  アップロード機能は有効になっています。
---- | --------------------
それ以外 |  アップロード機能は無効になっています。


詳しくは、CONFIGの[UPLOADに関する記述]({{ site.baseurl }}/docs/api/config#upload)を参照してください。

### リクエスト例:

`http://flashair/command.cgi?op=118`

### レスポンス例:

`1`

この機能は、ファームウェアバージョン2.00.02以上で利用可能です。

---
<h2 id="120">Card Identifierの取得</h2>
{: .mb-0 }
(op=120)
{: .text-small }

CID(Card Identification number register)を返します。CIDは32ケタの16進数で、SDメモリカード仕様により定められています。<br>
APPINFOについては、CIDの[CIDに関する記述]({{ site.baseurl }}/docs/api/config#cid)を参照してください。

### リクエスト例:

`http://flashair/command.cgi?op=120`

### レスポンス例:

`02544d535730384708c00b78700d201`

この機能は、ファームウェアバージョン1.00.03以上で利用可能です。

---
<h2 id="121">アップデート情報の取得 (タイムスタンプ形式)</h2>
{: .mb-0 }
(op=121)
{: .text-small }

SDメモリカードホスト機器から、FlashAirに対する書き込みイベントが発生した時の内部タイムスタンプを取得します。<br>
タイムスタンプはカードの起動時からの経過ミリ秒です。

### リクエスト例:

`http://flashair/command.cgi?op=121`

### レスポンス例:

`174428`

この機能は、ファームウェアバージョン2.00.02以上で利用可能です。

---
<h2 id="130">共有メモリからのデータの取得</h2>
{: .mb-0 }
(op=130)
{: .text-small }

共有メモリからデータを読み込みます。(SDメモリカード仕様で定められたコマンドCMD48: Read Extension Register Single Block Commandを実行します)

### リクエスト例:

`http://flashair/command.cgi?op=130&ADDR=0&LEN=8`

#### パラメータ:

##### **ADDR**
アドレス。`0-511` または`0x0-0x1FF`.

##### **LEN**
長さ。`0-512` または`0x0-0x200`.

### レスポンス例:

`0123ABCD`

成功しなかった場合は、`400 Bad Request` を返します。

この機能は、ファームウェアバージョン2.00.00以上で利用可能です。

---
<h2 id="131">共有メモリへのデータの書き込み</h2>
{: .mb-0 }
(op=131)
{: .text-small }

共有メモリにデータを書き込みます。(SDメモリカード仕様で定められたコマンドCMD49: Write Extension Register Single Block Commandを実行します)

### リクエスト例:

`http://flashair/command.cgi?op=131&ADDR=0&LEN=8&DATA=0123ABCD`

#### パラメータ:

##### **ADDR**
アドレス。`0-511` または`0x0-0x1FF`.
##### **LEN**
長さ。`0-512` または`0x0-0x200`.
##### **DATA**
書きこむデータ。データの長さははLENと同じでなければなりません。

### レスポンス:

成功した場合は、`SUCCESS` を返します。成功しなかった場合は、`400 Bad Request` を返します。

この機能は、ファームウェアバージョン2.00.00以上で利用可能です。

---
<h2 id="140">空セクター数の取得</h2>
{: .mb-0 }
(op=140)
{: .text-small }

FlashAirカードの空き容量を、**空セクタ数/全セクタ数,セクタサイズ(バイト)**の形式で返します。

### リクエスト例:

`http://flashair/command.cgi?op=140`

### レスポンス例:

`13952920/15228928,512`

この例では、セクタあたり512バイトで、カード全体では15228928個のセクタがあり、 13952920個のセクタが未使用であることを示しています。
つまり、総容量7.26GB(8GBカード)のうち、約6.7GB残っているということがわかります。

この機能は、ファームウェアバージョン1.00.03以上で利用可能です。

---
<h2 id="190">SDインターフェース端子のI/O利用</h2>
{: .mb-0 }
(op=190)
{: .text-small }

SDインターフェイス端子を、汎用のI/O信号端子として利用し、 信号の読み書きを行うことができます。

この機能を利用するためには以下の条件を満たしている必要があります。

* CONFIGファイルに`IFMODE=1`と記載されている。
* SDメモリカードスロットに挿入されていない（SDメモリカードホスト機器からのSD初期化が無い）。`IFMODE`については、CONFIGの[IFMODEに関する記述]({{ site.baseurl }}/docs/api/config#ifmode)を参照してください。

### リクエスト例:

`http://flashair/command.cgi?op=190&CTRL=0x1f&DATA=0x1f`

#### パラメータ:
##### **CTRL**
読み込みか書き込みかを指定します。<br>
読み込みたい端子に対応するビットに`0`を、 書き込みたい端子に対応するビットに`1`を指定します。

##### **DATA**
出力値の設定です。<br>
書き込みたい端子に対応する各ビットに、`0`を設定するとLow、`1`を設定するとHighを出力します。

#### ビット割当
  * **CMD** : 0x01
  * **D0** : 0x02
  * **D1** : 0x04
  * **D2** : 0x08
  * **D3** : 0x10

### レスポンス例:

現在の、読み書き設定および信号の値を取得できます。

`{"STATUS":"OK","CTRL":"0x00", "DATA":"0x00"}`

この機能は、ファームウェアバージョン2.00.03以上で利用可能です。

---
<h2 id="200">フォトシェアモードの有効化</h2>
{: .mb-0 }
(op=200)
{: .text-small }

フォトシェアモードを有効化します。フォトシェアモードは、指定されたディレクトリと日付のみにアクセスできるようにするために使われます。<br>
フォトシェアモードを有効にすると、 それ以降のHTTP GET要求およびcommand.cgiに対するディレクトリ指定は無視され、フォトシェアモードで指定したディレクトリと日付のデータが常に返されるようになります。

### リクエスト例:

`http://flashair/command.cgi?op=200&DIR=/DCIM/100__TSB&DATE=17153`

パラメータの詳細は、[ファイルリストの取得](#ファイルリストの取得)を参照してください。

### レスポンス:

成功した場合は、`OK` を返します。 成功しなかった場合は、`400 Bad Request` を返します。

この機能は、ファームウェアバージョン2.00.00以上で利用可能です。

### 注意:
op=200を使用してフォトシェアモードを有効にした場合、SSIDとネットワークセキュリティキーは、既に設定してある内容から変更されません。

ネットワークセキュリティキーを変更する場合には、config.cgiの[ネットワークセキュリティキーの設定]({{ site.baseurl }}/docs/api/config.cgi#appnetworkkey)を使用して、ネットワークセキュリティキーを変更してください。

また、SSIDを変更する場合は、config.cgiの[SSIDの設定]({{ site.baseurl }}/docs/api/config.cgi#appssid)を使用して、SSIDを変更してください。

---
<h2 id="201">フォトシェアモードの解除</h2>
{: .mb-0 }
(op=201)
{: .text-small }

フォトシェアモードを解除します。フォトシェアモードは、指定されたディレクトリと日付のみにアクセスできるようにするために使われます。

### リクエスト例:

`http://flashair/command.cgi?op=201`

### レスポンス:

成功した場合は、`OK` を返します。成功しなかった場合は、`400 Bad Request` を返します。

この機能は、ファームウェアバージョン2.00.00以上で利用可能です。

---
<h2 id="202">フォトシェアモードの状態の取得</h2>
{: .mb-0 }
(op=202)
{: .text-small }

フォトシェアモードが有効か無効かを返します。

### リクエスト例:

`http://flashair/command.cgi?op=202`

### レスポンス例:

`SHAREMODE`

フォトシェアモードが有効な場合は`SHAREMODE` を返します。フォトシェアモードが無効の場合は、`NORMALMODE` を返します。

この機能は、ファームウェアバージョン2.00.00以上で利用可能です。

---
<h2 id="203">フォトシェアモードのSSIDの取得</h2>
{: .mb-0 }
(op=203)
{: .text-small }

フォトシェアモードに使用する特別なSSIDを返します。

### リクエスト例:

`http://flashair/command.cgi?op=203`

### レスポンス例:

`photoshare_e8e0b756a7fb`

この機能は、ファームウェアバージョン2.00.00以上で利用可能です。

---
<h2 id="220">FlashAirドライブ(WebDAV)情報の取得</h2>
{: .mb-0 }
(op=220)
{: .text-small }

FlashAirドライブが有効か無効かを返します。

0 | FlashAirドライブ機能無効                                                                     
1 | FlashAirドライブ機能有効（リードオンリーモード）                                                         
2 | FlashAirドライブ機能有効。書き込みを有効にするには、CONFIGファイルに`UPLOAD=1`を設定する必要があります。

### リクエスト例:

`http://flashair/command.cgi?op=220`

### レスポンス例:

`1`

この機能は、ファームウェアバージョン3.00.00以上で利用可能です。

---
<h2 id="221">タイムゾーンの取得</h2>
{: .mb-0 }
(op=221)
{: .text-small }

FlashAirドライブ(WebDAV)動作時に、FATファイル時間からUTC時間へ変換するためのタイムゾーンの値を、15分を1とした単位で`-48`から`+54`の範囲で返します。<br>
日本は、UTC標準時を`0`とし、9時間進めたUTC+9であるため、`36`(9(h)×4(15m)=36)を設定します。

### リクエスト例:

`http://flashair/command.cgi?op=221`

### レスポンス例:

`36`

この機能は、ファームウェアバージョン3.00.00以上で利用可能です。
